(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{325:function(e,t,n){"use strict";n.r(t),n.d(t,"setJoinMode",(function(){return f})),n.d(t,"joinCallSuccess",(function(){return g})),n.d(t,"joinCallFailed",(function(){return I})),n.d(t,"joinCall",(function(){return _})),n.d(t,"leaveCall",(function(){return N})),n.d(t,"endCall",(function(){return P})),n.d(t,"startSharing",(function(){return D})),n.d(t,"sendDiagnosticsStart",(function(){return M})),n.d(t,"sendDiagnosticsEnd",(function(){return L})),n.d(t,"sendDiagnostics",(function(){return R})),n.d(t,"stopSharing",(function(){return v})),n.d(t,"admitAllParticipants",(function(){return y})),n.d(t,"admitParticipant",(function(){return j})),n.d(t,"blockParticipantAudio",(function(){return U})),n.d(t,"changeParticipantRole",(function(){return w})),n.d(t,"blockParticipantVideo",(function(){return k})),n.d(t,"blockAllParticipantAudio",(function(){return H})),n.d(t,"blockAllParticipantVideo",(function(){return V})),n.d(t,"changeParticipantImportance",(function(){return F})),n.d(t,"setLocked",(function(){return G})),n.d(t,"setRecording",(function(){return q})),n.d(t,"setStreaming",(function(){return x})),n.d(t,"setMicrophoneMute",(function(){return B})),n.d(t,"removeParticipant",(function(){return W})),n.d(t,"setCameraMute",(function(){return J})),n.d(t,"handleSizeHint",(function(){return K})),n.d(t,"handlePreviewMove",(function(){return Y})),n.d(t,"sendAddParticipant",(function(){return X})),n.d(t,"sendDirectorySearch",(function(){return $})),n.d(t,"cancelDirectorySearch",(function(){return Z})),n.d(t,"handleMicrophoneBlockedStatusChange",(function(){return Q})),n.d(t,"handleCameraBlockedStatusChange",(function(){return z})),n.d(t,"studioModeSyncAudioMute",(function(){return ee})),n.d(t,"studioModeSyncVideoMute",(function(){return te})),n.d(t,"socketLogs",(function(){return ne})),n.d(t,"microphoneBlockedStatusChanged",(function(){return ie})),n.d(t,"farEndCameraControlsViewChanged",(function(){return ae})),n.d(t,"cameraBlockedStatusChanged",(function(){return oe})),n.d(t,"voidNextUnblockNotification",(function(){return se})),n.d(t,"microphoneMutedStatusChanged",(function(){return re})),n.d(t,"cameraMutedStatusChanged",(function(){return ce})),n.d(t,"studioModeAudioStatusChanged",(function(){return de})),n.d(t,"studioModeVideoStatusChanged",(function(){return ue})),n.d(t,"awaitingActivationChanged",(function(){return he})),n.d(t,"shareFailed",(function(){return le})),n.d(t,"isOptimisedForTextChecked",(function(){return Ee})),n.d(t,"putParticipant",(function(){return pe})),n.d(t,"updateRoleChange",(function(){return me})),n.d(t,"deleteParticipant",(function(){return Se})),n.d(t,"updateAvailableLayouts",(function(){return Oe})),n.d(t,"selectLayout",(function(){return Ae})),n.d(t,"updateSelectedLayout",(function(){return Ce})),n.d(t,"updateParticipationPermissions",(function(){return Te})),n.d(t,"pubsubReset",(function(){return be})),n.d(t,"currentCallInfoUpdated",(function(){return fe})),n.d(t,"setMediaStatsNotificationStatus",(function(){return ge})),n.d(t,"currentAccessMethodsUpdated",(function(){return Ie})),n.d(t,"currentSpaceCallLegProfileUpdated",(function(){return _e})),n.d(t,"callMoveStart",(function(){return Ne})),n.d(t,"callMoveSuccess",(function(){return Pe})),n.d(t,"callMoveFailed",(function(){return De})),n.d(t,"chatMessageReceived",(function(){return Me})),n.d(t,"sendChatMessage",(function(){return Le})),n.d(t,"closedCaptionReceived",(function(){return Re})),n.d(t,"fileShareDetailsReceived",(function(){return ve})),n.d(t,"surveyDataReceived",(function(){return ye})),n.d(t,"activeSurveyDataReceived",(function(){return je})),n.d(t,"sendClosedCaption",(function(){return Ue})),n.d(t,"participantRoleChanged",(function(){return we})),n.d(t,"setRaiseHand",(function(){return ke})),n.d(t,"sendZoomCameraControls",(function(){return He})),n.d(t,"sendPanCameraControls",(function(){return Ve})),n.d(t,"sendTiltCameraControls",(function(){return Fe})),n.d(t,"handStatusChanged",(function(){return Ge})),n.d(t,"updateMeetingNotesReceived",(function(){return qe})),n.d(t,"sendMeetingNote",(function(){return xe}));var i=n(94),a=n(62),o=n(6),s=n(17),r=n(329),c=n(343),d=n(124),u=n(118),h=n(29),l=n(18),E=n(0),p=n(8),m=n(4),S=n(70),O=n(12),A=n(356),C=n(14),T=n(42),b=n(24);const f=e=>({mode:e,type:E.s}),g=()=>({type:E.n}),I=e=>(t,n)=>{c.c.release(!0,!1),c.c.request(Object(d.a)(n())),t({type:E.k,commonErrorCode:e})},_=(e,t,n)=>(a,s)=>{a(Object(r.c)()),a((()=>{const e=o.getSessionVariable(p.a.SESSION_TOKEN);return()=>{if(!e){const e=Object(i.v4)();Object(O.j)(e)}}})()),t&&a(f(t));const d=Object(m.H)(s())===b.a.RECONNECT_MEDIA_CONFIRMATION;o.setStorageVariable(p.a.MEDIA_RECONNECT_IN_PROGRESS,d),a({joinParams:e,type:E.m}),c.c.request(e).then(e=>{const i=Object(m.C)(s());e.join(i,t,n)}),a(ne("performed action of join call"))},N=e=>(t,n)=>{t(ne("performed action of leave call")),c.c.release(!e);const i=e||C.c.NOT_JOINED,a=Object(m.Zc)(n());if(t({callClientStatus:i,type:E.o}),!e||e===C.b.CALL_ENDED&&a){const e=n(),i=Object(m.Fc)(e);Object(m.Vd)(e)?Object(m.ke)(e)&&i&&i!==T.a?t(Object(l.i)(i)):t(Object(l.h)()):t(Object(l.e)())}},P=()=>e=>{e(ne("performed action of end call")),c.c.request().then(e=>{e.endCall()}).then(()=>{e({type:E.j})})},D=e=>t=>{t(Object(r.s)()),c.c.request(e).then(e=>{e.startSharing()})},M=()=>({type:E.fb}),L=e=>t=>{e&&t(Object(h.b)()),t({isSuccess:e,type:E.eb})},R=e=>t=>{const n=c.c.request(),i=n.then(e=>e.getRtcPeerConnectionDiagnostics());Promise.all([n,i]).then(n=>{let[i,o]=n;const{name:r,version:c,os:d}=Object(a.a)(),u={RTCPeerConnectionInfo:o,browser:{name:r,version:c,os:d},browserLogs:Object(s.a)(),description:e,version:"master.PR.7998"};let h=62e3-Object(A.a)(u.description)-Object(A.a)(u.version)-Object(A.a)(u.browser);const l=Object(A.a)(u.RTCPeerConnectionInfo);l>h?(Object(s.f)("Size of rtcPcConnectionDiagnostics ("+l+") too large to fit diagnostics message."),u.RTCPeerConnectionInfo=void 0):h-=l;const E=Object(A.a)(u.browserLogs);if(E>h){Object(s.f)("Size of logs ("+E+") too large to fit diagnostics message. Oldest logs were truncated.");const e=[];for(let t=u.browserLogs.length-1;t>=0;t--){const n=u.browserLogs[t],i=Object(A.a)(n);if(i>h)break;e.unshift(n),h-=i}e.unshift("*** Logs truncated ***"),u.browserLogs=e}t(M()),i.sendDiagnostics(u).then(()=>{t(L(!0))}).catch(()=>{t(L(!1))})})},v=e=>()=>{c.c.request(e).then(e=>{e.stopSharing(!1)})},y=()=>e=>{e(ne("performed action of admit all participant")),c.c.request().then(e=>{e.admitAllParticipants()})},j=e=>t=>{t(ne("performed action of admit participant on participant:".concat(e))),c.c.request().then(t=>{t.admitParticipant(e)})},U=(e,t)=>n=>{n(ne("performed action of block audio :".concat(t," on participant:").concat(e))),c.c.request().then(n=>{n.blockParticipantAudio(e,t)})},w=(e,t)=>{Object(S.a)("info","performed action of change role on participant:".concat(e)),c.c.request().then(n=>{n.changeParticipantRole(e,t)})},k=(e,t)=>n=>{n(ne("performed action of block video :".concat(t," on participant:").concat(e))),c.c.request().then(n=>{n.blockParticipantVideo(e,t)})},H=e=>t=>(t(ne("performed action of block all participant audio : ".concat(e))),c.c.request().then(t=>{t.blockAllParticipantAudio(e)}).then(()=>{t({type:e?E.Hd:E.Me})})),V=e=>t=>(t(ne("performed action of block all participant video : ".concat(e))),c.c.request().then(t=>{t.blockAllParticipantVideo(e)}).then(()=>{t({type:e?E.Id:E.Ne})})),F=(e,t)=>n=>{n(ne("performed action of change importance:".concat(t," on participant:").concat(e))),c.c.request().then(n=>{n.changeParticipantImportance(e,t)})},G=e=>t=>{t(ne("performed action of meeting lock : ".concat(e))),c.c.request().then(t=>{t.setLocked(e)})},q=e=>t=>{t(ne("performed action of set recording : ".concat(e))),c.c.request().then(t=>{t.setRecording(e)})},x=e=>t=>{t(ne("performed action of set streaming: ".concat(e))),c.c.request().then(t=>{t.setStreaming(e)})},B=(e,t)=>()=>{c.c.request(t).then(t=>{t.setMicrophoneMute(e)})},W=e=>t=>{t(ne("performed action of remove participant on : ".concat(e))),c.c.request().then(t=>{t.removeParticipant(e)})},J=(e,t)=>()=>{c.c.request(t).then(t=>{t.setCameraMute(e)})},K=e=>()=>{c.c.request().then(t=>{t.handleSizeHint(e)})},Y=(e,t)=>()=>{c.c.request().then(n=>{n.handlePreviewMove(e,t)})},X=e=>t=>(t(ne("performed action of add participant: ".concat(e))),c.c.request().then(t=>t.sendAddParticipant(e))),$=(e,t,n)=>()=>c.c.request().then(i=>i.sendDirectorySearch(e,t,n)),Z=e=>()=>c.c.request().then(t=>{t.cancelDirectorySearch(e)}),Q=e=>(t,n)=>{t(ie(e));const i=Object(m.td)(n()),a=Object(m.Pb)(n()).unblockOwnAudio;(e||!e&&!a&&i)&&c.c.request().then(t=>{t.setMicrophoneMute(e)})},z=e=>(t,n)=>{t(oe(e));const i=Object(m.ud)(n()),a=Object(m.Pb)(n()).unblockOwnVideo;(e||!e&&!a&&i)&&c.c.request().then(t=>{t.setCameraMute(e)})},ee=(e,t)=>(n,i)=>{const a=Object(m.Id)(i()),o=Object(m.Jd)(i()),s=Object(m.Ld)(i());c.c.request().then(i=>{s&&!e.unblockOwnAudio&&t&&!a&&o&&(i.setMicrophoneMute(!1),n(ie(!1)))})},te=(e,t)=>(n,i)=>{const a=Object(m.cd)(i()),o=Object(m.dd)(i()),s=Object(m.Ld)(i());c.c.request().then(i=>{s&&!e.unblockOwnVideo&&t&&!a&&o&&(i.setCameraMute(!1),n(oe(!1)))})},ne=e=>t=>{Object(S.a)("info",e)},ie=e=>({type:E.Fd,blocked:e}),ae=(e,t)=>({type:E.sc,participantGuid:e,enabled:t}),oe=e=>({type:E.u,blocked:e}),se=e=>({type:E.Se,deviceType:e}),re=e=>({type:E.Gd,muted:e}),ce=e=>({type:E.v,muted:e}),de=e=>(t,n)=>{const i=Object(m.Pb)(n());t(ee(i,e)),t({type:E.He,isInStudioMode:e})},ue=e=>(t,n)=>{const i=Object(m.Pb)(n());t(te(i,e)),t({type:E.Ie,isInStudioMode:e})},he=e=>t=>{t({type:E.i,awaitingActivation:e})},le=()=>({type:E.re}),Ee=()=>e=>{e({type:E.Ae})},pe=(e,t)=>n=>{Object(u.c)()===t.guid&&n(me(t)),n({guid:e,participant:t,type:E.Ld})},me=e=>(t,n)=>{(e.cospaceUserCallLegProfile&&Object(m.Nb)(n())!==e.cospaceUserCallLegProfile||e.accessMethod&&Object(m.Mb)(n())!==e.accessMethod)&&t(we(e.accessMethod,e.cospaceUserCallLegProfile))},Se=e=>({guid:e,type:E.Kd}),Oe=e=>({availableLayouts:e,type:E.x}),Ae=e=>t=>{t(Ce(e)),c.c.request().then(t=>{t.selectLayout(e)})},Ce=e=>({selectedLayout:e,type:E.F}),Te=e=>(t,n)=>{const i=Object(m.td)(n()),a=Object(m.ud)(n());t({newPermissions:e,type:E.C}),t(ee(e,i)),t(te(e,a))},be=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return{type:E.Pd,resetChatMessages:e,resetClosedCaptions:t,resetSharedFiles:n,resetSurveyData:i}},fe=e=>(t,n)=>{const i=Object(m.kb)(n());t({type:E.z,newCallInfo:e}),i!==e.logoFileName&&e.logoFileName&&c.c.request().then(n=>{n.requestLogoImage(e.logoFileName).then(e=>{t({type:E.od,logoImage:e})}).catch(()=>{t({type:E.od,logoImage:null})})})},ge=e=>t=>{t({isMediaStatsNotificationMuted:e,type:E.me})},Ie=e=>({newAccessMethods:e,type:E.y}),_e=e=>({newCospaceCallLegProfile:e,type:E.A}),Ne=e=>({type:E.q,newJoinParams:e}),Pe=()=>({type:E.r}),De=()=>({type:E.p}),Me=e=>({type:E.H,chatMessage:e}),Le=(e,t)=>()=>c.c.request().then(n=>n.sendChatMessage(e,t)),Re=e=>({type:E.K,closedCaption:e}),ve=e=>({type:E.yc,file:e}),ye=e=>({type:E.Je,surveys:e}),je=e=>({type:E.a,activeSurvey:e}),Ue=e=>()=>c.c.request().then(t=>t.sendClosedCaption(e)),we=(e,t)=>({type:E.Md,newAccessMethodGuid:e,newCospaceUserCallLegProfile:t}),ke=(e,t)=>()=>c.c.request().then(n=>n.setRaiseHand(e,t)),He=(e,t)=>()=>c.c.request().then(n=>n.sendZoomCameraControls(e,t)),Ve=(e,t)=>()=>c.c.request().then(n=>n.sendPanCameraControls(e,t)),Fe=(e,t)=>()=>c.c.request().then(n=>n.sendTiltCameraControls(e,t)),Ge=e=>({type:E.Qc,handStatus:e}),qe=e=>({type:E.B,newMeetingNotes:e}),xe=e=>()=>c.c.request().then(t=>t.sendMeetingNote(e))},326:function(e,t,n){"use strict";n.r(t),n.d(t,"MediaLibApi",(function(){return s})),n.d(t,"cancelPendingInvitationRequestWithWebsocket",(function(){return c})),n.d(t,"sendInvitationRequest",(function(){return d})),n.d(t,"sendStreamSelection",(function(){return u})),n.d(t,"sendSizeHints",(function(){return h})),n.d(t,"sendMediaSessionStatus",(function(){return l})),n.d(t,"sendEndCall",(function(){return E})),n.d(t,"sendAdmitAllParticipants",(function(){return p})),n.d(t,"sendAdmitParticipant",(function(){return m})),n.d(t,"sendBlockParticipantAudio",(function(){return S})),n.d(t,"sendChangeParticipantRole",(function(){return O})),n.d(t,"sendBlockAllParticipantAudio",(function(){return A})),n.d(t,"sendBlockParticipantVideo",(function(){return C})),n.d(t,"sendBlockAllParticipantVideo",(function(){return T})),n.d(t,"sendParticipantImportant",(function(){return b})),n.d(t,"sendClearAllParticipantsImportance",(function(){return f})),n.d(t,"sendRemoveParticipant",(function(){return g})),n.d(t,"sendDiagnostics",(function(){return I})),n.d(t,"sendSetLocked",(function(){return _})),n.d(t,"sendSetRecording",(function(){return N})),n.d(t,"sendSetStreaming",(function(){return P})),n.d(t,"sendChatMessage",(function(){return D})),n.d(t,"sendDirectedChatMessage",(function(){return M})),n.d(t,"sendClosedCaption",(function(){return L})),n.d(t,"sendAddParticipant",(function(){return R})),n.d(t,"sendDirectorySearch",(function(){return v})),n.d(t,"endSession",(function(){return y})),n.d(t,"sendHandStatus",(function(){return j})),n.d(t,"sendZoomCameraControlOperation",(function(){return U})),n.d(t,"sendPanCameraControlOperation",(function(){return w})),n.d(t,"sendTiltCameraControlOpeartion",(function(){return k})),n.d(t,"sendMeetingNote",(function(){return H})),n.d(t,"sendFileDetails",(function(){return V}));var i=n(355),a=n(5),o=n(327);n.d(t,"StreamLayout",(function(){return o.b})),n.d(t,"StreamPurpose",(function(){return o.c}));const s={sendIceCandidates:(e,t)=>{const n={data:{candidates:t},"http-method":o.a.POST,path:"/api/call/description/candidates"};return Object(i.i)(n)},sendLocalSdp:(e,t,n,a,s,r)=>{const c=[];r.content&&c.push({purpose:o.c.EXTENDED,videoStreamIdentifier:r.content}),(r.audio||r.video)&&c.push({audioStreamIdentifier:r.audio,purpose:o.c.MAIN,videoStreamIdentifier:r.video});const d={data:{SDP:a,candidates:s,isUnifiedPlan:n,streams:c},"http-method":o.a.POST,path:"/api/call/description/offer"};return Object(i.i)(d)},sendLocalStreamChanged:()=>{}},r={},c=()=>{r.pendingInvitationRetryId&&(clearTimeout(r.pendingInvitationRetryId),r.pendingInvitationRetryId=void 0)},d=(e,t)=>{const n={"http-method":o.a.POST,path:"/api/cospace/accessMethods/".concat(e,"/emailInvitation"),data:{language:t}};return Object(i.i)(n,!0).then(e=>Promise.resolve(e.data)).catch(n=>{if(n.data&&n.status===a.a.SERVICE_UNAVAILABLE&&n.data["retry-after"]){const i=1e3*n.data["retry-after"];return((e,t,n,i,a)=>new Promise(e=>{const t=setTimeout(e,n);return r.pendingInvitationRetryId=t,t}).then(()=>d(e,t)).then(e=>i(e)).catch(e=>a(e)))(e,t,i,Promise.resolve.bind(Promise),Promise.reject.bind(Promise))}return Promise.reject("Could not get invitation")})},u=e=>{const t={data:{streams:e},"http-method":o.a.POST,path:"/api/call/streams/selection"};return Object(i.i)(t)},h=e=>{const t={data:{streams:e},"http-method":o.a.POST,path:"/api/call/streams/size_hint"};return Object(i.i)(t)},l=(e,t,n)=>{const a={data:{audioMuted:e,videoMuted:t,extendedAudioMuted:n},"http-method":o.a.POST,path:"/api/call/status"};return Object(i.i)(a)},E=()=>{const e={"http-method":o.a.DELETE,path:"/api/call"};return Object(i.i)(e)},p=()=>{const e={"http-method":o.a.PUT,path:"/api/call/participants",data:{awaitingActivation:!1}};return Object(i.i)(e)},m=e=>{const t={"http-method":o.a.PUT,path:"/api/call/participants/".concat(e),data:{awaitingActivation:!1}};return Object(i.i)(t)},S=(e,t)=>{const n={"http-method":o.a.PUT,path:"/api/call/participants/".concat(e),data:{audioBlocked:t}};return Object(i.i)(n)},O=(e,t)=>{const n={"http-method":o.a.PUT,path:"/api/call/participants/".concat(e),data:{accessMethod:t}};return Object(i.i)(n)},A=e=>{const t={"http-method":o.a.PUT,path:"/api/call/participants",data:{audioBlocked:e}};return Object(i.i)(t)},C=(e,t)=>{const n={"http-method":o.a.PUT,path:"/api/call/participants/".concat(e),data:{videoBlocked:t}};return Object(i.i)(n)},T=e=>{const t={"http-method":o.a.PUT,path:"/api/call/participants",data:{videoBlocked:e}};return Object(i.i)(t)},b=(e,t)=>{const n={"http-method":o.a.PUT,path:"/api/call/participants/".concat(e),data:{isImportant:t}};return Object(i.i)(n)},f=()=>{const e={"http-method":o.a.PUT,path:"/api/call/participants",data:{isImportant:!1}};return Object(i.i)(e)},g=e=>{const t={"http-method":o.a.DELETE,path:"/api/call/participants/".concat(e)};return Object(i.i)(t)},I=e=>{const t={data:e,"http-method":o.a.POST,path:"/api/call/diagnostics"};return Object(i.i)(t,!0)},_=e=>{const t={"http-method":o.a.PUT,path:"/api/call/info",data:{locked:e}};return Object(i.i)(t)},N=e=>{const t={"http-method":o.a.PUT,path:"/api/call/info",data:{recordingActive:e}};return Object(i.i)(t)},P=e=>{const t={"http-method":o.a.PUT,path:"/api/call/info",data:{streamingActive:e}};return Object(i.i)(t)},D=e=>{const t={"http-method":o.a.POST,path:"/api/call/messageBoard",data:{body:e}};return Object(i.i)(t,!0)},M=(e,t)=>{const n={"http-method":o.a.POST,path:"/api/call/directedmessage",data:{receiverParticipantGuid:t,message:e}};return Object(i.i)(n,!0)},L=e=>{const t={"http-method":o.a.POST,path:"/api/call/caption",data:{body:e}};return Object(i.i)(t,!0)},R=e=>{const t={"http-method":o.a.POST,path:"/api/call/participants",data:{uri:e.trim()}};return Object(i.i)(t,!0).then(e=>e&&e.data&&e.data.participant?Promise.resolve(e.data.participant):Promise.reject("Did not get participant guid in response"))},v=e=>{const t={"http-method":o.a.GET,path:"/api/directory?query="+encodeURIComponent(e.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""))};return Object(i.i)(t,!0).then(e=>e&&e.data&&e.data.queryId&&e.data.avatar?Promise.resolve({queryId:e.data.queryId,avatar:e.data.avatar}):Promise.reject("Did not get queryId or avatar in response"))},y=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t={"http-method":o.a.POST,path:"/api/call/session/end"};return Object(i.i)(t,e)},j=(e,t)=>{const n={data:{handStatus:t},"http-method":o.a.PUT,path:"/api/call/participants/".concat(e)};return Object(i.i)(n)},U=(e,t)=>{const n={data:{zoom:t},"http-method":o.a.PUT,path:"/api/call/participants/".concat(e,"/cameraControl")};return Object(i.i)(n)},w=(e,t)=>{const n={data:{pan:t},"http-method":o.a.PUT,path:"/api/call/participants/".concat(e,"/cameraControl")};return Object(i.i)(n)},k=(e,t)=>{const n={data:{tilt:t},"http-method":o.a.PUT,path:"/api/call/participants/".concat(e,"/cameraControl")};return Object(i.i)(n)},H=e=>{const t={"http-method":o.a.POST,path:"/api/call/notes",data:{body:e}};return Object(i.i)(t,!0)},V=e=>{const t={"http-method":o.a.POST,path:"/api/call/fileshare",data:{fileUploadMetaData:e}};return Object(i.i)(t,!0)}},327:function(e,t,n){"use strict";let i,a,o;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),function(e){e.DEFAULT="Default",e.CUSTOM="Custom",e.ALL_EQUAL="All equal",e.OVERLAID="Overlaid",e.STACKED="Stacked",e.SPEAKER_ONLY="Speaker only",e.ONE_PLUS_N="One plus n",e.SPEAKERS_AND_PIPS="Speakers and pips",e.COMBINED="Combined",e.PRESENTATION="Presentation",e.NONE=""}(i||(i={})),function(e){e.MAIN="Main",e.EXTENDED="Extended"}(a||(a={})),function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS",e.HEAD="HEAD",e.PATCH="PATCH",e.TRACE="TRACE"}(o||(o={}))},329:function(e,t,n){"use strict";n.d(t,"v",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"u",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"q",(function(){return c})),n.d(t,"m",(function(){return d})),n.d(t,"l",(function(){return u})),n.d(t,"n",(function(){return h})),n.d(t,"r",(function(){return l})),n.d(t,"p",(function(){return E})),n.d(t,"e",(function(){return p})),n.d(t,"g",(function(){return m})),n.d(t,"i",(function(){return S})),n.d(t,"j",(function(){return O})),n.d(t,"k",(function(){return A})),n.d(t,"t",(function(){return C})),n.d(t,"h",(function(){return T})),n.d(t,"c",(function(){return b})),n.d(t,"s",(function(){return f})),n.d(t,"o",(function(){return g})),n.d(t,"d",(function(){return I})),n.d(t,"x",(function(){return _})),n.d(t,"z",(function(){return N})),n.d(t,"y",(function(){return P})),n.d(t,"A",(function(){return D})),n.d(t,"f",(function(){return M})),n.d(t,"w",(function(){return L}));var i=n(0);const a=()=>e=>{e({type:i.bc})},o=()=>e=>{e({type:i.pb})},s=()=>e=>{e({type:i.ac})},r=()=>e=>{e({type:i.ob})},c=()=>e=>{e({type:i.Nb})},d=()=>e=>{e({type:i.Fb})},u=()=>e=>{e({type:i.Eb})},h=()=>e=>{e({type:i.Gb})},l=()=>e=>{e({type:i.Ob})},E=()=>e=>{e({type:i.Ib})},p=()=>e=>{e({type:i.ub})},m=()=>e=>{e({type:i.yb})},S=()=>e=>{e({type:i.Bb})},O=()=>e=>{e({type:i.Cb})},A=()=>e=>{e({type:i.Db})},C=()=>e=>{e({type:i.Zb})},T=()=>e=>{e({type:i.Ab})},b=()=>e=>{e({type:i.qb})},f=()=>e=>{e({type:i.Sb})},g=()=>e=>{e({type:i.Qb})},I=()=>e=>{e({type:i.rb})},_=e=>t=>{t({type:i.ue,reason:e})},N=()=>e=>{e({type:i.we})},P=()=>e=>{e({type:i.ve})},D=()=>e=>{e({type:i.xe})},M=()=>e=>{e({type:i.vb})},L=()=>({type:i.Qd})},336:function(e,t,n){"use strict";let i,a;n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),function(e){e[e.SELF_VIEW=0]="SELF_VIEW",e[e.FAR_END_CAMERA_CONTROLS=1]="FAR_END_CAMERA_CONTROLS",e[e.PRESENTATION_PREVIEW=2]="PRESENTATION_PREVIEW"}(i||(i={})),function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_LEFT=2]="BOTTOM_LEFT",e[e.BOTTOM_RIGHT=3]="BOTTOM_RIGHT"}(a||(a={}))},343:function(e,t,n){"use strict";n.d(t,"b",(function(){return V})),n.d(t,"a",(function(){return F})),n.d(t,"e",(function(){return B})),n.d(t,"f",(function(){return W})),n.d(t,"d",(function(){return J}));var i=n(344),a=n(422),o=n.n(a),s=n(64),r=n.n(s),c=n(6),d=n(17),u=n(333),h=n(62),l=n(20),E=n(44),p=n(3),m=n(5);let S;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){if(!e.turnServers)return null;const t={iceServers:[]};return e.turnServers.forEach(e=>{e.udpPort&&t.iceServers&&t.iceServers.push({credential:e.password,urls:["turn:".concat(e.address,":").concat(e.udpPort,"?transport=udp"),"turn:".concat(e.address,":").concat(e.tcpPort,"?transport=tcp")],username:e.username})}),t}function b(){switch(Object(h.a)().name){case"firefox":return S.Firefox;case"edge":return S.Edge;case"safari":case"ios":return S.Safari;case"chrome":case"edge-chromium":case"yandexbrowser":return S.Chrome;default:return S.Unknown}}!function(e){e.Firefox="Firefox",e.Edge="Edge",e.Safari="Safari",e.Chrome="Chrome",e.Unknown="Unknown"}(S||(S={}));var f=n(355),g=n(326),I=n(8),_=n(14),N=n(121),P=n(327);function D(e,t,n,i,a){switch(function(e,t){let n=t.length>1?t[0]:N.a.NONE;const i=c.getStorageVariable(I.a.MEDIA_STATISTICS_HEALTH_STATUS);e&&(e.layout===N.a.AUDIO_ONLY&&!e.wasRemoteShareAvailable&&t.includes(N.a.PRESENTATION)?n=N.a.PRESENTATION:(a=e.layout,[N.a.ALL_EQUAL,N.a.SPEAKER_LARGE,N.a.SPEAKER_ONLY,N.a.CUSTOM,N.a.DEFAULT].includes(a)&&!e.wasRemoteShareAvailable&&(t.includes(N.a.PRESENTATION_AND_VIDEO)||t.includes(N.a.PRESENTATION))?n=i!==_.i.HEALTH_STATUS_UNDEFINED?t.includes(N.a.PRESENTATION_AND_VIDEO)&&i===_.i.HEALTH_STATUS_GOOD?N.a.PRESENTATION_AND_VIDEO:N.a.PRESENTATION:t.includes(N.a.PRESENTATION_AND_VIDEO)?N.a.PRESENTATION_AND_VIDEO:N.a.PRESENTATION:t.includes(e.layout)&&(n=e.layout)));var a;return n}(e,t)){case N.a.AUDIO_ONLY:return{cmaLayoutChosen:N.a.AUDIO_ONLY,extended:P.b.NONE,main:P.b.NONE,shouldMuteVideo:e&&e.layout===N.a.AUDIO_ONLY};case N.a.ALL_EQUAL:return{cmaLayoutChosen:N.a.ALL_EQUAL,extended:P.b.NONE,main:P.b.ALL_EQUAL};case N.a.SPEAKER_LARGE:return{cmaLayoutChosen:N.a.SPEAKER_LARGE,extended:P.b.NONE,main:!a.includes(P.b.OVERLAID)&&P.b.STACKED||!a.includes(P.b.STACKED)&&P.b.OVERLAID||n>i?P.b.OVERLAID:P.b.STACKED};case N.a.SPEAKER_ONLY:return{cmaLayoutChosen:N.a.SPEAKER_ONLY,extended:P.b.NONE,main:P.b.SPEAKER_ONLY};case N.a.PRESENTATION:return{cmaLayoutChosen:N.a.PRESENTATION,extended:P.b.PRESENTATION,main:P.b.NONE};case N.a.PRESENTATION_AND_VIDEO:return{cmaLayoutChosen:N.a.PRESENTATION_AND_VIDEO,extended:P.b.PRESENTATION,main:a.includes(P.b.DEFAULT)&&P.b.DEFAULT||a.includes(P.b.CUSTOM)&&P.b.CUSTOM||a.includes(P.b.ALL_EQUAL)&&P.b.ALL_EQUAL||a.includes(P.b.OVERLAID)&&P.b.OVERLAID||a.includes(P.b.STACKED)&&P.b.STACKED||P.b.SPEAKER_ONLY};case N.a.DEFAULT:return{cmaLayoutChosen:N.a.DEFAULT,extended:P.b.NONE,main:P.b.DEFAULT};case N.a.CUSTOM:return{cmaLayoutChosen:N.a.CUSTOM,extended:P.b.NONE,main:P.b.CUSTOM};case N.a.NONE:return{cmaLayoutChosen:N.a.NONE,extended:P.b.NONE,main:P.b.NONE}}}var M=n(87),L=n(9),R=n(61),v=n(336),y=n(11),j=n(42),U=n(7);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){H(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const V={AWAITING_ACTIVATION_CHANGED:"@connection-manager/AWAITING_ACTIVATION_CHANGED",CAMERA_BLOCKED_STATUS_CHANGED:"@connection-manager/CAMERA_BLOCKED_STATUS_CHANGED",FAR_END_CAMERA_CONTROLS_ENABLED:"@connection-manager/FAR_END_CAMERA_CONTROLS_ENABLED",CAMERA_MUTED_STATUS_CHANGED:"@connection-manager/CAMERA_MUTED_STATUS_CHANGED",STUDIO_MODE_AUDIO_STATUS_CHANGED:"@connection-manager/STUDIO_MODE_AUDIO_STATUS_CHANGED",STUDIO_MODE_VIDEO_STATUS_CHANGED:"@connection-manager/STUDIO_MODE_VIDEO_STATUS_CHANGED",CHANGE_CONNECTION_STATE:"@connection-manager/CHANGE_CONNECTION_STATE",CHANGE_REMOTE_CONTENT_STREAM:"@connection-manager/CHANGE_REMOTE_CONTENT_STREAM",CHANGE_REMOTE_STREAM:"@connection-manager/CHANGE_REMOTE_STREAM",CHAT_MESSAGE_RECEIVED:"@connection-manager/CHAT_MESSAGE_RECEIVED",CLOSED_CAPTION_RECEIVED:"@connection-manager/CLOSED_CAPTION_RECEIVED",FILE_SHARE_DETAILS_RECEIVED:"@connection-manager/FILE_SHARE_DETAILS_RECEIVED",DROPPED_FROM_CALL:"@connection-manager/DROPPED_FROM_CALL",JOIN_FAILED:"@connection-manager/JOIN_FAILED",JOIN_SUCCESS:"@connection-manager/JOIN_SUCCESS",MICROPHONE_BLOCKED_STATUS_CHANGED:"@connection-manager/MICROPHONE_BLOCKED_STATUS_CHANGED",MICROPHONE_MUTED_STATUS_CHANGED:"@connection-manager/MICROPHONE_MUTED_STATUS_CHANGED",PARTICIPANT_DELETE_RECEIVED:"@connection-manager/PARTICIPANT_DELETE_RECEIVED",PARTICIPANT_PUT_RECEIVED:"@connection-manager/PARTICIPANT_PUT_RECEIVED",PUBSUB_RESET:"@connection-manager/PUBSUB_RESET",SHARE_FAILED:"@connection-manager/SHARE_FAILED",UPDATE_AVAILABLE_LAYOUTS:"@connection-manager/UPDATE_AVAILABLE_LAYOUTS",UPDATE_PARTICIPATION_PERMISSIONS:"@connection-manager/UPDATE_PARTICIPATION_PERMISSIONS",UPDATE_REMOTE_CONTENT_MAX_ZOOM:"@connection-manager/UPDATE_REMOTE_CONTENT_MAX_ZOOM",UPDATE_SELECTED_LAYOUT:"@connection-manager/UPDATE_SELECTED_LAYOUT",CALL_INFO_RECEIVED:"@connection-manager/CALL_INFO_RECEIVED",ACCESS_METHODS_RECEIVED:"@connection-manager/ACCESS_METHODS_RECEIVED",SPACE_PROFILE_RECEIVED:"@connection-manager/SPACE_PROFILE_RECEIVED",MOVE_START:"@connection-manager/MOVE_START",MOVE_SUCCESS:"@connection-manager/MOVE_SUCCESS",MOVE_FAILED:"@connection-manager/MOVE_FAILED",HAND_STATUS_CHANGED:"@connection-manager/HAND_STATUS_CHANGED",PARTICIPANT_ROLE_CHANGED:"@connection-manager/PARTICIPANT_ROLE_CHANGED",MEETING_NOTE_RECEIVED:"@connection-manager/MEETING_NOTE_RECEIVED",SURVEY_DATA_RECEIVED:"@connection-manager/SURVEY_DATA_RECEIVED",ACTIVE_SURVEY_DATA_RECEIVED:"@connection-manager/ACTIVE_SURVEY_DATA_RECEIVED"},F=new i.EventEmitter;class G{constructor(e){H(this,"mode",{active:!1,awaitingActivation:!1,block:{camera:!1,microphone:!1},local:{audio:!0,presentation:!1,video:!0},mute:{camera:!1,microphone:!1,presentationAudio:!1},studioMode:{audio:!1,video:!1},remote:{audio:!0,presentation:!0,video:!0}}),H(this,"joinParams",void 0),H(this,"configuration",void 0),H(this,"mediaConnection",void 0),H(this,"isInCall",void 0),H(this,"initCallId",void 0),H(this,"websocketListenersRegistered",void 0),H(this,"streamDimensions",void 0),H(this,"lastAdvertisedStreams",void 0),H(this,"availableCMALayouts",void 0),H(this,"userSelectedCMALayoutConfig",void 0),H(this,"hasWebsocketSession",void 0),H(this,"reconnectIntervalId",void 0),H(this,"wasMediaConnectionEstablished",void 0),H(this,"checkMediaConnectedIntervalId",void 0),H(this,"checkMediaStatisticsIntervalId",void 0),H(this,"mediaStatisticsInitialIntervalId",void 0),H(this,"currentJoinMode",void 0),this.joinParams=e,this.mediaConnection=null,this.isInCall=!1,this.initCallId=0,this.websocketListenersRegistered=!1,this.streamDimensions={extended:{width:window.innerWidth,height:window.innerHeight},main:{width:window.innerWidth,height:window.innerHeight},selfViewNoGoZone:{x:0,y:0,height:0,width:0},presentationPreviewNoGoZone:{x:0,y:0,height:0,width:0}},this.lastAdvertisedStreams=void 0,this.availableCMALayouts=[],this.userSelectedCMALayoutConfig=void 0,this.hasWebsocketSession=!1,this.reconnectIntervalId=null,this.wasMediaConnectionEstablished=!1,this.setMuteMode("camera",u.b.getSelectedCamera()),this.setMuteMode("microphone",u.b.getSelectedMicrophone()),this.initCall=this.initCall.bind(this),this.sendJoinRequest=this.sendJoinRequest.bind(this),this.requestLogoImage=this.requestLogoImage.bind(this),this.checkMediaConnected=this.checkMediaConnected.bind(this),this.connectWebsocket=this.connectWebsocket.bind(this),this.requestUserMedia=this.requestUserMedia.bind(this),this.initMediaConnection=this.initMediaConnection.bind(this),this.initSharing=this.initSharing.bind(this),this.updateMediaSessionStatus=this.updateMediaSessionStatus.bind(this),this.setMicrophoneBlockStatus=this.setMicrophoneBlockStatus.bind(this),this.setCameraBlockStatus=this.setCameraBlockStatus.bind(this),this.handleSizeHint=this.handleSizeHint.bind(this),this.onJoinSuccess=this.onJoinSuccess.bind(this),this.onJoinFailed=this.onJoinFailed.bind(this),this.join=this.join.bind(this),this.onFinishedJoinRequest=this.onFinishedJoinRequest.bind(this),this.onSelectedDevicesChanged=this.onSelectedDevicesChanged.bind(this),this.onConnectionStateChanged=this.onConnectionStateChanged.bind(this),this.onRemoteStreamChanged=this.onRemoteStreamChanged.bind(this),this.onRemoteContentStreamChanged=this.onRemoteContentStreamChanged.bind(this),this.onAwaitingSdpChanged=this.onAwaitingSdpChanged.bind(this),this.setMuteMode=this.setMuteMode.bind(this),this.onShareChanged=this.onShareChanged.bind(this)}getMode(){return this.mode}getJoinParams(){return this.joinParams}join(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.a.LOCAL,n=arguments.length>2?arguments[2]:void 0;return this.mode.active=!0,this.configuration=e,this.currentJoinMode=t,c.setSessionVariable(I.a.CAMERA_MUTED_FORCEFULLY,!1),t===U.a.PRESENTATION_ONLY&&(this.mode.remote={audio:!1,presentation:!0,video:!1},this.mode.local={audio:!1,presentation:!1,video:!1},this.mode.mute={camera:!0,microphone:!0}),this.userSelectedCMALayoutConfig=n,l.j({joinMode:t,layoutConfig:this.userSelectedCMALayoutConfig}),this.initCall().then(()=>{this.mode.active&&this.mediaConnection&&this.mediaConnection.setManagementMode(t===U.a.PRESENTATION_ONLY)}).then(this.onJoinSuccess,this.onJoinFailed).catch(e=>{this.onJoinFailed(e)})}leave(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(this.mode.active=!1,l.a(),u.f.releaseUserMedia(this),u.f.setBlurMode(0,50),u.f.setBlurStatus(!1)),clearInterval(this.reconnectIntervalId),this.checkMediaStatisticsIntervalId&&clearInterval(this.checkMediaStatisticsIntervalId),this.mediaStatisticsInitialIntervalId&&(clearTimeout(this.mediaStatisticsInitialIntervalId),this.mediaStatisticsInitialIntervalId=void 0),this.disconnectMediaConnection();return c.getSessionVariable(I.a.CAMERA_MUTED_FORCEFULLY)&&this.setCameraMute(!1),c.setStorageVariable(I.a.MEDIA_STATISTICS_HEALTH_STATUS,_.i.HEALTH_STATUS_UNDEFINED),this.stopSharing(!1).catch(e=>{if(!e||!e.ErrorCode||e.ErrorCode!==y.a.CALL_INIT_CALL_INACTIVE)throw e}),e?Object(g.endSession)(!n).catch(()=>{t?(d.c("Could not end session on the websocket. Sending /calls/leave request instead..."),new Promise((e,t)=>{p.c.post("/calls/leave").then(n=>{if(n.status!==m.a.OK)return t("Could not leave call");e({})}).catch(Object(p.b)(e=>{t({ErrorCode:e.response&&e.response.status,message:e.message})}))})):d.c("Could not end session on the websocket")}).then(()=>{Object(f.e)(void 0),Object(f.d)(),this.isInCall=!1,this.hasWebsocketSession=!1}):(Object(f.e)(void 0),Object(f.d)(),this.isInCall=!1,this.hasWebsocketSession=!1),Object(f.f)(),this.websocketListenersRegistered=!1,Promise.resolve()}sendDiagnostics(e){return Object(g.sendDiagnostics)(e).catch(t=>{return t.status===m.a.BAD_REQUEST||t.status===m.a.NOT_FOUND?Promise.reject(t):(d.c("Could not send diagnostics on the websocket. Attempting to sending as http request instead..."),n=e,new Promise((e,t)=>{p.c.post("/call/diagnostics",n).then(n=>{if(n.status!==m.a.OK)return t("Could not report http diagnostics request");e({})}).catch(e=>{t({ErrorCode:e.response&&e.response.status,message:e.message})})}));var n})}isSharing(){return null!==u.a.getStream()}getRtcPeerConnectionDiagnostics(){return this.mediaConnection.getDiagnostics()}startSharing(){return this.isSharing()&&u.a.stopSharing(),this.mode.local.presentation=!0,this.mode.remote.presentation=!1,this.initCall()}stopSharing(e){u.a.off(u.c.CHANGE_DESKTOP_STREAM,this.onShareChanged),this.mode.local.presentation=!1,this.mode.remote.presentation=!0;const t=c.getStorageVariable(I.a.MEDIA_STATISTICS_HEALTH_STATUS);switch(this.mode.mute.presentationAudio||(this.mode.mute.presentationAudio=!0,this.updateMediaSessionStatus()),e){case!0:t===_.i.HEALTH_STATUS_GOOD?this.selectLayout(N.a.PRESENTATION_AND_VIDEO):t===_.i.HEALTH_STATUS_POOR&&this.selectLayout(N.a.PRESENTATION);break;case!1:if(t===_.i.HEALTH_STATUS_GOOD||t===_.i.HEALTH_STATUS_POOR){const e=c.getStorageVariable(I.a.LAST_SELECTED_LAYOUT);this.selectLayout(e)}}return this.isSharing()?u.a.stopSharing().then(this.initCall):Promise.resolve()}onSelectedDevicesChanged(e,t,n){this.setMuteMode("camera",e),this.setMuteMode("microphone",t),this.updateMediaSessionStatus(!0)}setMicrophoneMute(e){c.setSessionVariable(I.a.MICROPHONE_MUTE,e),this.setMuteMode("microphone",u.b.getSelectedMicrophone()),this.updateMediaSessionStatus(!0)}setCameraMute(e,t){t&&c.setSessionVariable(I.a.CAMERA_MUTED_FORCEFULLY,!0),c.setSessionVariable(I.a.CAMERA_MUTE,e),this.setMuteMode("camera",u.b.getSelectedCamera()),this.updateMediaSessionStatus(!0)}setRaiseHand(e,t){Object(g.sendHandStatus)(e,t),F.emit(V.HAND_STATUS_CHANGED,t)}sendZoomCameraControls(e,t){Object(g.sendZoomCameraControlOperation)(e,t)}sendPanCameraControls(e,t){Object(g.sendPanCameraControlOperation)(e,t)}sendTiltCameraControls(e,t){Object(g.sendTiltCameraControlOpeartion)(e,t)}selectLayout(e){this.userSelectedCMALayoutConfig={layout:e,wasRemoteShareAvailable:this.availableCMALayouts.includes(N.a.PRESENTATION_AND_VIDEO)||this.availableCMALayouts.includes(N.a.PRESENTATION)},l.j({layoutConfig:this.userSelectedCMALayoutConfig}),this.lastAdvertisedStreams&&this.sendStreamSelection(this.lastAdvertisedStreams)}endCall(){Object(g.sendEndCall)()}admitAllParticipants(){Object(g.sendAdmitAllParticipants)()}admitParticipant(e){Object(g.sendAdmitParticipant)(e)}blockParticipantAudio(e,t){Object(g.sendBlockParticipantAudio)(e,t)}changeParticipantRole(e,t){Object(g.sendChangeParticipantRole)(e,t)}blockAllParticipantAudio(e){return Object(g.sendBlockAllParticipantAudio)(e)}blockParticipantVideo(e,t){Object(g.sendBlockParticipantVideo)(e,t)}blockAllParticipantVideo(e){return Object(g.sendBlockAllParticipantVideo)(e)}removeParticipant(e){Object(g.sendRemoveParticipant)(e)}changeParticipantImportance(e,t){Object(g.sendParticipantImportant)(e,t)}setLocked(e){Object(g.sendSetLocked)(e)}setRecording(e){Object(g.sendSetRecording)(e)}setStreaming(e){Object(g.sendSetStreaming)(e)}sendChatMessage(e,t){return this.hasWebsocketSession?t===L.f?Object(g.sendChatMessage)(e):Object(g.sendDirectedChatMessage)(e,t):Promise.reject("Websocket is disconnected")}sendAddParticipant(e){return Object(g.sendAddParticipant)(e)}sendDirectorySearch(e,t,n){return Object(g.sendDirectorySearch)(e).then(e=>{const i=RegExp("^/api/directory/".concat(e.queryId,"$"));return Object(f.b)(P.a.POST,i,t),Object(f.b)(P.a.DELETE,i,n),Promise.resolve(e)})}cancelDirectorySearch(e){const t=void 0===e?RegExp("^/api/directory/[0-9a-f\\-]+$"):RegExp("^/api/directory/".concat(e,"$"));Object(f.g)(P.a.POST,t),Object(f.g)(P.a.DELETE,t)}handleSizeHint(e){if(e.purpose===P.c.MAIN){if(Math.abs(this.streamDimensions.main.height-e.height)<2&&Math.abs(this.streamDimensions.main.width-e.width)<2)return;this.streamDimensions.main={width:e.width,height:e.height}}else if(e.purpose===P.c.EXTENDED){if(Math.abs(this.streamDimensions.extended.height-e.height)<=2&&Math.abs(this.streamDimensions.extended.width-e.width)<=2){const t=this.streamDimensions.extended.roiWidth!==e.roiWidth&&(void 0===this.streamDimensions.extended.roiWidth||void 0===e.roiWidth||Math.abs(this.streamDimensions.extended.roiWidth-e.roiWidth)>=2),n=this.streamDimensions.extended.roiHeight!==e.roiHeight&&(void 0===this.streamDimensions.extended.roiHeight||void 0===e.roiHeight||Math.abs(this.streamDimensions.extended.roiHeight-e.roiHeight)>=2),i=this.streamDimensions.extended.roiX!==e.roiX&&(void 0===this.streamDimensions.extended.roiX||void 0===e.roiX||Math.abs(this.streamDimensions.extended.roiX-e.roiX)>=2),a=this.streamDimensions.extended.roiY!==e.roiY&&(void 0===this.streamDimensions.extended.roiY||void 0===e.roiY||Math.abs(this.streamDimensions.extended.roiY-e.roiY)>=2);if(!(t||n||i||a))return}this.streamDimensions.extended={width:e.width,height:e.height,roiX:e.roiX,roiY:e.roiY,roiWidth:e.roiWidth,roiHeight:e.roiHeight}}this.mode.active&&this.hasWebsocketSession&&(e.purpose===P.c.MAIN&&(e.no_go=this.generateNoGoArray()),Object(g.sendSizeHints)([e]))}handlePreviewMove(e,t){e===v.a.SELF_VIEW?this.streamDimensions.selfViewNoGoZone={x:t.x,y:t.y,width:t.width,height:t.height}:e===v.a.PRESENTATION_PREVIEW&&(this.streamDimensions.presentationPreviewNoGoZone={x:t.x,y:t.y,width:t.width,height:t.height}),this.mode.active&&this.hasWebsocketSession&&Object(g.sendSizeHints)([{purpose:P.c.MAIN,width:this.streamDimensions.main.width,height:this.streamDimensions.main.height,no_go:this.generateNoGoArray()}])}generateNoGoArray(){const e=[];return 0!==this.streamDimensions.selfViewNoGoZone.width&&e.push(this.streamDimensions.selfViewNoGoZone),0!==this.streamDimensions.presentationPreviewNoGoZone.width&&e.push(this.streamDimensions.presentationPreviewNoGoZone),e}doIfInitIsValid(e,t){return this.mode.active?t!==this.initCallId?Promise.reject({ErrorCode:y.a.CALL_INIT_INVALID_ID}):e():Promise.reject({ErrorCode:y.a.CALL_INIT_CALL_INACTIVE})}initCall(){if(!this.mode.active)return Promise.reject({ErrorCode:y.a.CALL_INIT_CALL_INACTIVE});if(this.configuration){const e=c.getStorageVariable(I.a.OPTIMISE_FOR_TEXT)?"max1080p":this.configuration.contentResolution;u.f.setPresentationResolutionRestrict(e)}const e=++this.initCallId;return this.doIfInitIsValid(this.sendJoinRequest,e).then(t=>this.doIfInitIsValid(this.onFinishedJoinRequest.bind(this,t),e)).then(()=>this.doIfInitIsValid(this.connectWebsocket,e)).then(()=>this.doIfInitIsValid(this.requestUserMedia,e)).then(()=>this.doIfInitIsValid(this.initMediaConnection,e)).then(()=>this.doIfInitIsValid(this.initSharing,e)).catch(e=>this.doIfInitIsValid(Promise.reject.bind(Promise,e),this.initCallId))}onJoinSuccess(){this.mode.active&&(F.emit(V.JOIN_SUCCESS),c.setStorageVariable(I.a.MEDIA_RECONNECT_IN_PROGRESS,!1))}onJoinFailed(e){if(e&&e.ErrorCode&&(e.ErrorCode===y.a.CALL_INIT_CALL_INACTIVE||e.ErrorCode===y.a.CALL_INIT_INVALID_ID))return void d.f("Call join aborted: Code "+e.ErrorCode);let t;("Meeting not found"===e.errorCause&&404===e.ErrorCode||400===e.ErrorCode&&"Bad meeting details"===e.errorCause)&&(t=404),d.b("Call join failed: "+(e.message||""),e);c.getStorageVariable(I.a.MEDIA_RECONNECT_IN_PROGRESS)||F.emit(V.JOIN_FAILED,t)}sendJoinRequest(){if(this.isInCall){const e=l.b();return Promise.resolve({webrtcConfig:e&&e.webrtcConfig})}return e=this.joinParams,new Promise((t,n)=>{const i=l.b();i&&JSON.stringify(i.joinParams)===JSON.stringify(e)?t({callJWT:i.callJWT,webrtcConfig:i.webrtcConfig}):p.c.post("/join",A(A({},e),{},{userAgent:b()})).then(e=>{if(e.status!==m.a.OK||!e.data)return n("Could not join call");t({callJWT:e.data.jwt,webrtcConfig:T(e.data)}),Object(E.c)()}).catch(Object(p.b)(e=>{var t;n({ErrorCode:e.response&&e.response.status,message:e.message,errorCause:null===(t=e.response)||void 0===t?void 0:t.data.error})}))});var e}requestLogoImage(e){return(e=>new Promise((t,n)=>{p.c.post("logofile",e,{responseType:"arraybuffer"}).then(e=>e.status===m.a.OK&&e.data?t(e.data):n("Could not load Image")).catch(e=>{n({ErrorCode:e.response&&e.response.status,message:e.message})})}))(e)}sendMeetingNote(e){return this.hasWebsocketSession?Object(g.sendMeetingNote)(e):Promise.reject("Websocket is disconnected")}sendClosedCaption(e){return this.hasWebsocketSession?Object(g.sendClosedCaption)(e):Promise.reject("Websocket is disconnected")}onFinishedJoinRequest(e){if(l.j(k(k({},e),{},{joinParams:this.joinParams})),!this.configuration)return d.f("Configuration is missing! Cannot join any calls without it."),Promise.reject("configuration missing");const t={chromeBaseProfileUseLevel50:"auto"===this.configuration.webrtcChromeH264InteropMode,safariBaseProfileUseLevel50:"auto"===this.configuration.webrtcSafariH264InteropMode,rtcConfig:e&&e.webrtcConfig||{}};return t.rtcConfig.sdpSemantics="unified-plan",Object(u.j)(t),this.isInCall=!0,Promise.resolve()}addEndSessionListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/session/end$"),e=>{const t=e.data&&e.data.disconnectReason;e.hasOwnProperty("requestId")&&Object(f.h)(e.requestId,m.a.OK).then(()=>{F.emit(V.DROPPED_FROM_CALL,t)})},!1)}addRemoteSdpListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/description/answer$"),e=>{e.data&&e.data.hasOwnProperty("SDP")&&Object(u.h)(e.data.SDP)})}sendStreamSelection(e){const t=[],n={audio:!1,video:!1,content:!1};if(e){const i=e.filter(e=>e.purpose===P.c.MAIN),a=D(this.userSelectedCMALayoutConfig,this.availableCMALayouts,this.streamDimensions.main.width,this.streamDimensions.main.height,!!i.length&&i[0].layouts&&i[0].layouts||[]);a.shouldMuteVideo&&this.setCameraMute(!0),a.cmaLayoutChosen!==N.a.DEFAULT&&F.emit(V.UPDATE_SELECTED_LAYOUT,a.cmaLayoutChosen),e.forEach(e=>{if(e.hasOwnProperty("purpose")){const i=e.purpose;i===P.c.MAIN?(n.audio=e.hasOwnProperty("audioStreamIdentifier")&&!!e.audioStreamIdentifier&&this.mode.remote.audio,n.video=e.hasOwnProperty("videoStreamIdentifier")&&!!e.videoStreamIdentifier&&this.mode.remote.video&&!!a.main,(n.video||n.audio)&&t.push({audio:n.audio,backgroundColour:"F2F4F5",height:this.streamDimensions.main.height,layout:a.main,purpose:P.c.MAIN,video:n.video,width:this.streamDimensions.main.width,no_go:this.generateNoGoArray()})):i===P.c.EXTENDED&&(n.content=e.hasOwnProperty("videoStreamIdentifier")&&!!e.videoStreamIdentifier&&this.mode.remote.presentation&&!!a.extended,n.content&&t.push({audio:!1,backgroundColour:"F2F4F5",height:this.streamDimensions.extended.height,layout:a.extended,purpose:P.c.EXTENDED,video:n.content,width:this.streamDimensions.extended.width,no_go:[]}))}})}this.mediaConnection&&(this.mediaConnection.setActiveStreams(n),Object(g.sendStreamSelection)(t))}handleServerStreamAdvertisement(e){const t={main:null,presentation:null};let n=[],i=[];e&&e.forEach(e=>{e.hasOwnProperty("purpose")&&(e.purpose===P.c.MAIN&&e.videoStreamIdentifier&&e.layouts&&e.layouts.length>0&&(1!==e.layouts.length||e.layouts[0]!==P.b.PRESENTATION)?(t.main=e.videoStreamIdentifier,n=e.layouts&&e.layouts||[]):e.purpose===P.c.MAIN&&e.audioStreamIdentifier?t.main=e.audioStreamIdentifier:e.purpose===P.c.EXTENDED&&e.videoStreamIdentifier&&e.layouts&&e.layouts.includes(P.b.PRESENTATION)&&(t.presentation=e.videoStreamIdentifier,i=e.layouts&&e.layouts||[],e.sourceWidth&&e.sourceHeight?F.emit(V.UPDATE_REMOTE_CONTENT_MAX_ZOOM,e.sourceWidth,e.sourceHeight):F.emit(V.UPDATE_REMOTE_CONTENT_MAX_ZOOM,void 0,void 0)))}),this.availableCMALayouts=function(e,t,n){const i=[];return!n&&t.includes(P.b.PRESENTATION)&&(e.includes(P.b.ALL_EQUAL)||e.includes(P.b.OVERLAID)||e.includes(P.b.STACKED)||e.includes(P.b.SPEAKER_ONLY)||e.includes(P.b.CUSTOM)||e.includes(P.b.DEFAULT))&&i.push(N.a.PRESENTATION_AND_VIDEO),!n&&t.includes(P.b.PRESENTATION)&&i.push(N.a.PRESENTATION),e.includes(P.b.DEFAULT)&&i.push(N.a.DEFAULT),e.includes(P.b.CUSTOM)&&i.push(N.a.CUSTOM),e.includes(P.b.ALL_EQUAL)&&i.push(N.a.ALL_EQUAL),(e.includes(P.b.OVERLAID)||e.includes(P.b.STACKED))&&i.push(N.a.SPEAKER_LARGE),e.includes(P.b.SPEAKER_ONLY)&&i.push(N.a.SPEAKER_ONLY),i.push(N.a.AUDIO_ONLY),i}(n,i,this.mode.local.presentation),F.emit(V.UPDATE_AVAILABLE_LAYOUTS,this.availableCMALayouts),Object(u.i)(t),this.lastAdvertisedStreams=e,this.sendStreamSelection(e)}handleServerStreamInfo(e){var t,n,i;if(this.availableCMALayouts.includes(N.a.PRESENTATION_AND_VIDEO)||this.availableCMALayouts.includes(N.a.PRESENTATION)||(null===(t=this.userSelectedCMALayoutConfig)||void 0===t?void 0:t.layout)===N.a.AUDIO_ONLY||!e)(null===(n=this.userSelectedCMALayoutConfig)||void 0===n?void 0:n.layout)!==N.a.AUDIO_ONLY&&(null===(i=this.userSelectedCMALayoutConfig)||void 0===i?void 0:i.layout)!==N.a.DEFAULT&&(this.userSelectedCMALayoutConfig={layout:N.a.DEFAULT,wasRemoteShareAvailable:!1},l.j({layoutConfig:this.userSelectedCMALayoutConfig}));else{const t=function(e){switch(e){case P.b.OVERLAID:case P.b.STACKED:case P.b.ONE_PLUS_N:case P.b.SPEAKERS_AND_PIPS:return N.a.SPEAKER_LARGE;case P.b.ALL_EQUAL:return N.a.ALL_EQUAL;case P.b.SPEAKER_ONLY:return N.a.SPEAKER_ONLY;case P.b.CUSTOM:return N.a.CUSTOM;default:return N.a.ALL_EQUAL}}(e);t===N.a.CUSTOM?(F.emit(V.UPDATE_SELECTED_LAYOUT,N.a.CUSTOM),this.selectLayout(N.a.CUSTOM)):(F.emit(V.UPDATE_SELECTED_LAYOUT,t),this.selectLayout(N.a.DEFAULT))}}addStreamAdvertisementListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/streams/advertisement$"),e=>{this.handleServerStreamAdvertisement(e.data&&e.data.streams)})}addStreamInfoListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/streams/info$"),e=>{this.handleServerStreamInfo(e.data&&e.data.layout)})}addStreamSelectionListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/streams/selection$"),e=>{const t=e.data&&e.data.streams;t&&t.some(e=>e.purpose&&e.purpose===P.c.EXTENDED&&e.video)||this.stopSharing(!0).then(this.handleServerStreamAdvertisement(this.lastAdvertisedStreams))})}addParticipantListListeners(){Object(f.b)(P.a.PUT,RegExp("^/api/call/participants/[0-9a-f\\-]+$"),e=>{const t=e.path.split("/")[4],n=JSON.parse(e.data);n.guid=t,F.emit(V.PARTICIPANT_PUT_RECEIVED,t,n)}),Object(f.b)(P.a.DELETE,RegExp("^/api/call/participants/[0-9a-f\\-]+$"),e=>{const t=e.path.split("/")[4];F.emit(V.PARTICIPANT_DELETE_RECEIVED,t)})}addParticipationPermissionsListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/participation/permissions$"),e=>{if(e.data){const t=e.data;F.emit(V.UPDATE_PARTICIPATION_PERMISSIONS,t)}})}addParticipationStatusListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/participation/status$"),e=>{e.data&&(this.setMicrophoneBlockStatus(e.data.audioRemotelyBlocked),this.setCameraBlockStatus(e.data.videoRemotelyBlocked),this.setAwaitingActivation(e.data.awaitingActivation),this.setStudioModeVideoStatus(e.data.studioModeVideo),this.setStudioModeAudioStatus(e.data.studioModeAudio))})}addCallInfoListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/info/$"),e=>{if(e.data){const t=JSON.parse(e.data);F.emit(V.CALL_INFO_RECEIVED,k(k({},t),{},{messageExpiry:t.messageExpiry?new Date(t.messageExpiry):void 0}))}})}addChatMessageListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/messageBoard/[0-9a-f\\-]+$"),e=>{if(e.data){const t=JSON.parse(e.data),n=e.path.split("/")[4];if(t.body&&t.participantGuid&&t.username&&t.displayName&&t.timestamp&&t.avatar){const e=new Date(t.timestamp);F.emit(V.CHAT_MESSAGE_RECEIVED,k(k({},t),{},{messageGuid:n,timestamp:e,timestampText:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}}})}addDirectedChatMessageListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/directedmessage/[0-9a-f\\-]+$"),e=>{if(e.data){const t=JSON.parse(e.data),n=e.path.split("/")[4];if(t.body&&t.participantGuid&&t.username&&t.displayName&&t.timestamp&&t.avatar){const e=new Date(t.timestamp);F.emit(V.CHAT_MESSAGE_RECEIVED,k(k({},t),{},{messageGuid:n,timestamp:e,timestampText:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}}})}addClosedCaptionListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/caption/[0-9a-f\\-]+$"),e=>{if(e.data){const t=JSON.parse(e.data),n=e.path.split("/")[4];if(t.body&&t.timestamp){const e=new Date(t.timestamp);F.emit(V.CLOSED_CAPTION_RECEIVED,k(k({},t),{},{messageGuid:n,timestamp:e,timestampText:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}}})}addFileDetailsListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/fileshare/[0-9a-f\\-]+$"),e=>{if(e.data){const t=JSON.parse(e.data),n=e.path.split("/")[4],i=[],a=JSON.parse(t.fileUploadMetaData);for(const e of a)i.push(e);if(t.participantGuid){const e=new Date(t.filetimestamp);F.emit(V.FILE_SHARE_DETAILS_RECEIVED,k(k({},t),{},{fileUploadMetaData:i,messageGuid:n,timestamp:e,timestampText:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}}})}addMeetingNoteListener(){Object(f.b)(P.a.PUT,RegExp("^/api/call/notes/[0-9a-f\\-]+$"),e=>{if(e.data){const t=JSON.parse(e.data),n=e.path.split("/")[4];if(t.body&&t.participantGuid&&t.username&&t.displayName&&t.timestamp){const e=new Date(t.timestamp);F.emit(V.MEETING_NOTE_RECEIVED,k(k({},t),{},{messageGuid:n,timestamp:e,timestampText:e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}}})}addAccessMethodsListener(){Object(f.b)(P.a.POST,RegExp("^/api/cospace/info$"),e=>{if(e.data&&e.data.accessMethods){const t=Object(R.b)(e.data.accessMethods);F.emit(V.ACCESS_METHODS_RECEIVED,t)}e.data&&e.data.callLegProfile&&F.emit(V.SPACE_PROFILE_RECEIVED,e.data.callLegProfile)})}addCallMoveListener(){Object(f.b)(P.a.POST,RegExp("^/api/call/session/move$"),e=>{if(e.data&&e.data.jwt){const t=this.joinParams;let n;n=e.data.cospaceGuid?{guid:e.data.cospaceGuid,trace:t.trace}:e.data.accessMethod&&(e.data.accessMethod.numericId||e.data.accessMethod.uri)&&(void 0!==e.data.accessMethod.passcode||e.data.accessMethod.secret)?{numericId:e.data.accessMethod.numericId||void 0,uri:e.data.accessMethod.numericId?void 0:e.data.accessMethod.uri,secret:e.data.accessMethod.secret||void 0,passcode:e.data.accessMethod.secret?void 0:e.data.accessMethod.passcode,displayName:t.displayName,trace:t.trace}:{guid:j.a,trace:t.trace},this.leave(!0,!1,!0).then(()=>{this.joinParams=n,l.j({callJWT:e.data.jwt,joinParams:n}),F.emit(V.MOVE_START,n),this.initCall().then(()=>{F.emit(V.MOVE_SUCCESS)}).catch(()=>{F.emit(V.MOVE_FAILED)})})}})}connectWebsocket(){const e=this;return e.hasWebsocketSession?Promise.resolve():(e.websocketListenersRegistered||(e.addEndSessionListener(),e.addParticipationPermissionsListener(),e.addParticipationStatusListener(),e.addParticipantListListeners(),e.addRemoteSdpListener(),e.addStreamAdvertisementListener(),e.addStreamInfoListener(),e.addStreamSelectionListener(),e.addCallInfoListener(),e.addChatMessageListener(),e.addClosedCaptionListener(),e.addDirectedChatMessageListener(),e.addFileDetailsListener(),e.addAccessMethodsListener(),e.addCallMoveListener(),e.addWebsocketDisconnectListener(),e.addMeetingNoteListener(),e.websocketListenersRegistered=!0),Object(f.c)().then(()=>(this.hasWebsocketSession=!0,this.disconnectMediaConnection(),Promise.resolve())).catch(e=>{throw d.b("WebSocket connection failed with error ".concat(e)),e}))}addWebsocketDisconnectListener(){Object(f.e)(e=>{const t=this.hasWebsocketSession;this.hasWebsocketSession=!1,Object(f.e)(void 0),this.websocketListenersRegistered=!1,F.emit(V.PUBSUB_RESET,!1,!1),e===f.a.AUTH_FAILURE_NON_RECOVERABLE?(d.f("Websocket got disconnected due to non-recoverable auth failure. Ending call."),clearInterval(this.reconnectIntervalId),F.emit(V.DROPPED_FROM_CALL,_.b.CALL_ENDED)):e===f.a.OVERRIDEN?(d.f("Websocket got disconnected, because it was overriden by another browser session. Leaving call."),clearInterval(this.reconnectIntervalId),F.emit(V.DROPPED_FROM_CALL,_.b.REMOVED)):t&&(d.f("Websocket got disconnected involuntarily. Attempting to reconnect..."),clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=setInterval(()=>{this.initCall().then(()=>{clearInterval(this.reconnectIntervalId)})},5e3))})}requestUserMedia(){if(this.mode.local.audio||this.mode.local.video)return u.f.requestUserMedia(this).then(this.updateMediaSessionStatus)}setMicrophoneBlockStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mode.block.microphone!==e&&(this.mode.block.microphone=e,F.emit(V.MICROPHONE_BLOCKED_STATUS_CHANGED,e))}setCameraBlockStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mode.block.camera!==e&&(this.mode.block.camera=e,F.emit(V.CAMERA_BLOCKED_STATUS_CHANGED,e))}setStudioModeVideoStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mode.studioMode.video!==e&&(this.mode.studioMode.video=e,F.emit(V.STUDIO_MODE_VIDEO_STATUS_CHANGED,e))}setStudioModeAudioStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mode.studioMode.audio!==e&&(this.mode.studioMode.audio=e,F.emit(V.STUDIO_MODE_AUDIO_STATUS_CHANGED,e))}setAwaitingActivation(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mode.awaitingActivation!==e&&(this.mode.awaitingActivation=e,F.emit(V.AWAITING_ACTIVATION_CHANGED,e))}setMuteMode(e,t){t&&"none"!==t.id?this.mode.mute[e]=!!c.getSessionVariable("camera"===e?I.a.CAMERA_MUTE:I.a.MICROPHONE_MUTE):this.mode.mute[e]=!0}updateMediaSessionStatus(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.mode.mute.microphone;(e||t!==u.f.isAudioMuted())&&(u.f.setAudioMute(t),F.emit(V.MICROPHONE_MUTED_STATUS_CHANGED,t));const n=this.mode.mute.camera;(e||n!==u.f.isVideoMuted())&&(u.f.setVideoMute(n),F.emit(V.CAMERA_MUTED_STATUS_CHANGED,n));const i=this.mode.mute.presentationAudio;this.mode.active&&Object(g.sendMediaSessionStatus)(t,n,i)}onConnectionStateChanged(e){e===M.a.CONNECTED&&(this.wasMediaConnectionEstablished=!0,this.checkMediaConnectedIntervalId&&clearInterval(this.checkMediaConnectedIntervalId)),F.emit(V.CHANGE_CONNECTION_STATE,e),e===M.a.FAILED&&(this.checkMediaConnectedIntervalId&&clearInterval(this.checkMediaConnectedIntervalId),F.emit(V.DROPPED_FROM_CALL,this.wasMediaConnectionEstablished?_.b.MEDIA_RECONNECT_FAIL:_.b.MEDIA_CONNECT_FAIL)),e===M.a.DISCONNECTED&&(this.checkMediaConnectedIntervalId&&clearInterval(this.checkMediaConnectedIntervalId),this.checkMediaConnectedIntervalId=setInterval(this.checkMediaConnected,2e4))}onRemoteStreamChanged(e){F.emit(V.CHANGE_REMOTE_STREAM,e)}onRemoteContentStreamChanged(e){F.emit(V.CHANGE_REMOTE_CONTENT_STREAM,e)}onAwaitingSdpChanged(e){e&&Object(u.h)(null)}checkMediaConnected(){if(this.mediaConnection){const e=this.mediaConnection.getMediaConnectionState();e!==M.a.NEW&&e!==M.a.CONNECTING&&e!==M.a.FAILED||this.wasMediaConnectionEstablished?e===M.a.FAILED&&F.emit(V.DROPPED_FROM_CALL,_.b.MEDIA_RECONNECT_FAIL):F.emit(V.DROPPED_FROM_CALL,_.b.MEDIA_CONNECT_FAIL)}}initMediaConnection(){if(!this.mediaConnection){this.mediaConnection=new u.d(null),this.mediaConnection.on(u.c.CHANGE_CONNECTION_STATE,this.onConnectionStateChanged),this.mediaConnection.on(u.c.CHANGE_REMOTE_STREAM,this.onRemoteStreamChanged),this.mediaConnection.on(u.c.CHANGE_REMOTE_CONTENT_STREAM,this.onRemoteContentStreamChanged),this.mediaConnection.on(u.c.CHANGE_AWAITING_SDP,this.onAwaitingSdpChanged);const e=this.mode.local.audio||this.mode.local.video||this.mode.local.presentation;this.mediaConnection.connect(e),this.checkMediaConnectedIntervalId=setInterval(this.checkMediaConnected,2e4)}return Promise.resolve()}disconnectMediaConnection(){this.mediaConnection&&(this.mediaConnection.off(u.c.CHANGE_CONNECTION_STATE,this.onConnectionStateChanged),this.mediaConnection.off(u.c.CHANGE_REMOTE_STREAM,this.onRemoteStreamChanged),this.mediaConnection.off(u.c.CHANGE_REMOTE_CONTENT_STREAM,this.onRemoteContentStreamChanged),this.mediaConnection.off(u.c.CHANGE_AWAITING_SDP,this.onAwaitingSdpChanged),this.mediaConnection.disconnect(),this.mediaConnection=null,this.checkMediaConnectedIntervalId&&(clearInterval(this.checkMediaConnectedIntervalId),this.checkMediaConnectedIntervalId=void 0),this.wasMediaConnectionEstablished=!1,F.emit(V.CHANGE_REMOTE_STREAM,null),F.emit(V.CHANGE_REMOTE_CONTENT_STREAM,null))}initSharing(){return!this.mode.local.presentation||this.isSharing()?Promise.resolve():new Promise(e=>{u.a.on(u.c.CHANGE_DESKTOP_STREAM,this.onShareChanged),u.a.startSharing().then(()=>{if(c.getStorageVariable(I.a.MEDIA_STATISTICS_HEALTH_STATUS)===_.i.HEALTH_STATUS_POOR){var t;const e=null===(t=l.b().layoutConfig)||void 0===t?void 0:t.layout;c.setStorageVariable(I.a.LAST_SELECTED_LAYOUT,e),this.selectLayout(N.a.AUDIO_ONLY)}e()}).catch(()=>{u.a.on(u.c.CHANGE_DESKTOP_STREAM,this.onShareChanged),this.mode.local.presentation&&this.stopSharing(void 0),F.emit(V.SHARE_FAILED),e()})})}onShareChanged(e){e&&o()(e.getTracks(),{kind:"audio"}).length?this.mode.mute.presentationAudio=!1:this.mode.mute.presentationAudio=!0,this.updateMediaSessionStatus(),e||this.stopSharing(!1)}}const q={currentManager:void 0,isCallClientBootstrapped:!1},x=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];q.currentManager&&(q.currentManager.leave(e,t),q.currentManager=void 0)},B=()=>{q.isCallClientBootstrapped=!0},W=()=>{q.isCallClientBootstrapped=!1},J=()=>q.isCallClientBootstrapped;t.c={release:x,request:e=>new Promise((t,n)=>{const i=q.currentManager&&q.currentManager.getJoinParams();if(!(e=e||i))return n("CallConnection not initialized");q.currentManager&&r()(e,i)||(x(!0,!1),q.currentManager=new G(e)),function e(){q.isCallClientBootstrapped&&q.currentManager?t(q.currentManager):setTimeout(e,500)}()})};window.getCM=()=>q.currentManager},355:function(e,t,n){"use strict";n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return M})),n.d(t,"e",(function(){return m})),n.d(t,"f",(function(){return b})),n.d(t,"g",(function(){return A})),n.d(t,"i",(function(){return y})),n.d(t,"h",(function(){return R})),n.d(t,"a",(function(){return E}));var i=n(344),a=n(38),o=n(17),s=n(20),r=n(12),c=n(5),d=n(327);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E;!function(e){e[e.AUTH_FAILURE_NON_RECOVERABLE=0]="AUTH_FAILURE_NON_RECOVERABLE",e[e.AUTH_FAILURE_OTHER=1]="AUTH_FAILURE_OTHER",e[e.OVERRIDEN=2]="OVERRIDEN",e[e.OTHER=3]="OTHER"}(E||(E={}));const p={emitter:new i.EventEmitter,requestHandlers:[]};function m(e){p.onDisconnect=e?Object(a.debounce)(e,1e3):void 0}function S(e){const t=JSON.parse(e.data);if(t.requestId&&t.status)p.emitter.emit("@socket/RESPONSE_RECEIVED_"+t.requestId,t);else{if(!t.path)return void o.f("Invalid message received on websocket. Does not contain a path. Ignoring it");if(!t["http-method"]||!Object.values(d.a).includes(t["http-method"]))return void o.f("Invalid message received on websocket. Does not contain a valid http-method. Ignoring it");let e=!1;p.requestHandlers.forEach(n=>{if(n.httpMethod===t["http-method"]&&n.pathRegExp.test(t.path))return e=!0,void((e,t,n)=>{new Promise(()=>{try{t.forEach(t=>{t(e)})}catch(t){return o.b("Caught exception when handling request: ",t),n?R(e.requestId,c.a.INTERNAL_SERVER_ERROR):Promise.resolve()}return n?R(e.requestId,c.a.OK):Promise.resolve()})})(t,n.listeners,n.autoResponse)}),e||(o.f("Unexpected message received on websocket. No handlers found for "+t["http-method"]+" "+t.path),R(t.requestId,c.a.NOT_FOUND))}}function O(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!1;p.requestHandlers.forEach(o=>{o.httpMethod===e&&o.pathRegExp.toString()===t.toString()&&(a=!0,o.listeners.push(n),!0===o.autoResponse&&(o.autoResponse=i))}),a||p.requestHandlers.push({autoResponse:i,httpMethod:e,listeners:[n],pathRegExp:t})}function A(e,t,n){p.requestHandlers.forEach((i,a,o)=>{i.httpMethod===e&&i.pathRegExp.toString()===t.toString()&&(i.listeners=n?i.listeners.filter(e=>e!==n):[]),0===i.listeners.length&&o.splice(a,1)})}function C(e,t){p.emitter.addListener("@socket/RESPONSE_RECEIVED_"+e,t)}function T(e,t){p.emitter.removeListener("@socket/RESPONSE_RECEIVED_"+e,t)}function b(){p.emitter.removeAllListeners(),p.requestHandlers=[]}var f;!function(e){e.NO_WEBSOCKET="No websocket to authenticate on",e.TIMEOUT="Authentication timed out",e.NOT_FOUND="Not found",e.FAILED="Authentication failed"}(f||(f={}));const{getNextRequestId:g,getLastRequestId:I}=(()=>{let e=0;return{getLastRequestId:()=>e,getNextRequestId:()=>++e}})();function _(e){o.f("Websocket error: ",e),p.reject&&p.reject("WebSocket error: "+e),M(E.OTHER,!1)}function N(e){o.f("Websocket closed: ",e),p.reject&&p.reject("WebSocket was closed involuntarily");M(e&&4e3===e.code?E.OVERRIDEN:E.OTHER,!1)}function P(e){const t=Object(r.f)(r.a.CALL);if(t&&t.exp&&t.exp<Math.floor(Date.now()/1e3))return p.reject&&p.reject("JWT websocket expired"),void M(E.AUTH_FAILURE_NON_RECOVERABLE);let n=new WebSocket("wss://".concat(window.location.host.toLowerCase()).concat(e));n.websocket&&(n=n.websocket),p.websocket=n,p.websocket?(p.websocket.onerror=_,p.websocket.onclose=N,p.websocket.onmessage=S,p.websocket.onopen=()=>{new Promise((e,t)=>{if(!p.websocket)return void t(f.NO_WEBSOCKET);const n=Object(s.c)(),i=g();p.websocket.send(JSON.stringify({data:{jwt:n},"http-method":d.a.POST,path:"/api/call/authentication",requestId:i}));const a=n=>{T(i,a),n.status>=200&&n.status<300?e(p.websocket):t(n.status===c.a.NOT_FOUND?f.NOT_FOUND:f.FAILED)};C(i,a),setTimeout(()=>{T(i,a),t(f.TIMEOUT)},5e3)}).then(()=>{p.websocket?p.resolve&&p.resolve(p.websocket):_("Websocket creation failed")}).catch(e=>{p.reject&&p.reject("Could not authenticate"),M(e===f.NOT_FOUND?E.AUTH_FAILURE_NON_RECOVERABLE:E.AUTH_FAILURE_OTHER,!1)})}):_("Websocket creation failed")}function D(){if(p.connectPromise)return p.connectPromise;const e=new Promise((e,t)=>{p.resolve=e,p.reject=t,P("/websockify/")});return e.catch(t=>{p.connectPromise===e&&(M(),o.f("Websocket error: "+t))}),p.connectPromise=e,e}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.OTHER,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return b(),p.onDisconnect&&p.onDisconnect(e),p.reject&&t&&p.reject("Disconnected"),p.reject=void 0,p.resolve=void 0,p.websocket&&(p.websocket.onclose=null,p.websocket.onerror=null,p.websocket.onopen=null,p.websocket.onmessage=null,p.websocket.close()),p.websocket=void 0,p.connectPromise=void 0,Promise.resolve()}function L(){return p.connectPromise?p.connectPromise:(M(),Promise.reject("Expected websocket to be connected but it was not"))}function R(e,t,n){return void 0===e?Promise.resolve({}):L().then(i=>(i.send(JSON.stringify({data:n,requestId:e,status:t})),Promise.resolve({})))}function v(e){return new Promise((t,n)=>{const i=a=>{T(e,i),a.status>=200&&a.status<300?t(h(h({},a),{},{data:a.data?"string"==typeof a.data?JSON.parse(a.data):a.data:void 0})):n(a)};C(e,i),setTimeout(()=>{T(e,i),n({requestId:e,status:408})},1e4)})}function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return L().then(n=>{const i=g();return n.send(JSON.stringify(h(h({},e),{},{requestId:i}))),t?v(i):Promise.resolve({})})}},356:function(e,t,n){"use strict";function i(e){return a("string"==typeof e?e:JSON.stringify(e))}function a(e){let t=e.length;if(0===t)return 0;for(let n=e.length-1;n>=0;n--){const i=e.charCodeAt(n);i>127&&i<=2047?t++:i>2047&&i<=65535&&(t+=2),i>=56320&&i<=57343&&n--}return t}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}))}}]);